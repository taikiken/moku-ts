<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
      }
      .page {
        padding: 16px;
      }

      .style-container {
        width: 50%;
        height: 100px;
        border: 1px solid #ccc;
        border-radius: 3px 4px 5px 6px;
        background: blanchedalmond;
        font-family: "American Typewriter", sans-serif;
        font-size: 13px;
        line-height: 1.25;
        font-weight: 600;
        padding: 5px 6px 7px 8px;
      }
    </style>
  </head>
  <body>
  <div class="page">
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
    <h2>CSS</h2>
    <div class="style-container">.style-container test</div>
    <pre id="style-message"></pre>
    <label>
      <span>choose:</span>
      <input type="text" class="style-choice">
    </label>
    <input type="button" class="style-button" value="css">
    <script type="module">
      import ComputedStyle from './src/moku/util/style/ComputedStyle'

      const message = document.getElementById('style-message')
      const input = document.querySelector('.style-choice')
      const button = document.querySelector('.style-button')

      const computed = new ComputedStyle(document.querySelector('.style-container'))
      const onClick = () => {
        const { value } = input
        if (value) {
          const css = computed.getValue(value);
          message.textContent = `${value}: ${css}`;
        } else {
          message.textContent = ''
        }
      }
      button.addEventListener('click', onClick, false)
    </script>

    <h2>queries</h2>
    <pre id="queries-message"></pre>
    <div style="word-break: break-all;">
      <a href="/">/</a>
      <br>
      <a href="/?note=xyz&module=xbxbxb">/?note=xyz&module=xbxbxb</a>
      <br>
      <a href="/?mini=true&amp;url=xxx.xxx%2F3gPDxUj&amp;title=%E8%A5%BF%E6%97%A5%E6%9C%AC%E3%82%92%E4%B8%AD%E5%BF%83%E3%81%AB%E3%81%BE%E3%81%A8%E3%81%BE%E3%81%A3%E3%81%9F%E9%9B%A8%E9%9B%B2%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%8A%E3%80%81%E6%BF%80%E3%81%97%E3%81%84%E9%9B%A8%E3%81%AE%E9%99%8D%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E6%89%80%E3%81%8C%E3%81%82%E3%82%8B%E3%81%8C%E3%80%81%E3%81%93%E3%81%AE%E3%81%82%E3%81%A8%E3%81%95%E3%82%89%E3%81%AB%E9%9B%A8%E3%81%AE%E7%AF%84%E5%9B%B2%E3%81%8C%E5%BA%83%E3%81%8C%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B%E3%80%82&amp;summary=&amp;source=">/?mini=true&amp;summary=&amp;source=</a>
    </div>
    <script type="module">
      import queries from './src/moku/net/queries'
      const message = document.getElementById('queries-message')
      const parsed = queries.parse()
      console.log('parsed', parsed)
      Object.keys(parsed).map((key, index) => {
        const div = document.createElement('div')
        div.textContent = `${index}. ${key}: ${parsed[key]}`
        message.appendChild(div)
      })
    </script>

    <h2>NativeResizing</h2>
    <pre id="message"></pre>
    <script type="module">
      // NativeResizing
      import NativeResizingSingle from './src/moku/event/NativeResizingSingle'
      import NativeResizing from './src/moku/event/NativeResizing'
      const resizing = NativeResizingSingle.factory()
      const message = document.getElementById('message')
      let count = 0
      const onResizing = (events) => {
        // console.log('events', events.option)
        count = count + 1
        const div = document.createElement('div')
        const p = document.createElement('p')
        p.textContent = `${count}.
        y: ${events.option.scroll.y},
        moved: ${events.option.scroll.moved},
        body.width: ${events.option.body.width},
        body.height: ${events.option.body.height},
        frame.width: ${events.option.frame.width},
        frame.height: ${events.option.frame.height},
        frame.bottom: ${events.option.frame.bottom},
        `
        div.appendChild(p)
        if (message.hasChildNodes()) {
          message.replaceChild(div, message.childNodes[0]);
        } else {
          message.appendChild(div)
        }
        // if (count === 10) {
        //   resizing.off(NativeResizing.UPDATE, onResizing)
        // }
      }
      resizing.on(NativeResizing.UPDATE, onResizing)
      resizing
        .start()
        .fire()
    </script>

    <h2>Intersection</h2>
    <div class="rise" style="height: 300px; border: 1px solid #ccc; margin: 10px;"></div>
    <div class="rise" style="height: 300px; border: 1px solid #ccc; margin: 10px;"></div>
    <div class="rise" style="height: 300px; border: 1px solid #ccc; margin: 10px;"></div>
    <div class="rise" style="height: 300px; border: 1px solid #ccc; margin: 10px;"></div>
    <div class="rise" style="height: 300px; border: 1px solid #ccc; margin: 10px;"></div>
    <script type="module">
      import Intersection from './src/moku/util/Intersection'
      const observer = new Intersection();
      observer.intersect = function (entry) {
        entry.target.classList.add('intersect')
        entry.target.textContent = 'intersect'
        this.unobserve(entry.target)
      }
      Array.from(document.getElementsByClassName('rise')).map((element) => {
        observer.add(element)
      })
    </script>
  </div>
  </body>
</html>
